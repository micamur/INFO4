#!/bin/sh

GRP_ID=`id -g`
USR_ID=`id -u`

if [ $GRP_ID -eq 1000 ]
then
    # rien a faire, tout baigne dans ce cas
    echo "/bin/sh" > fixuid.sh
elif  [ $GRP_ID -eq 0 ]
then echo "Ne pas lancer ce script en tant que root !!"; exit 2
else
    # ce script créé un utilisateur dont les id/grp correspondent à l'appelant.
    # Il est appelé par l'image jahierwan/ricm-pf-tools
        echo "# Generated by docker-ltpf, do not edit!

sudo groupadd -g $GRP_ID ltpf
sudo adduser -u $USR_ID --gid $GRP_ID ltpf-user --disabled-password --gecos \"\"
sudo ln -s /home/opam/.opam/ /home/ltpf-user/.opam

#eval \`opam config env\`
sudo -u ltpf-user /bin/bash -c \"export NO_AT_BRIDGE=1;eval \\\`opam config env\\\`; $SHELL\"
" > fixuid.sh
fi
#chmod -w fixuid.sh
chmod +x fixuid.sh
docker run -v "$PWD":/current_dir -w /current_dir -e DISPLAY=$DISPLAY -v /tmp/.X11-unix:/tmp/.X11-unix -it jahierwan/ricm-pf-tools
