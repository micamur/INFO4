# TR 3 - NFS

## Introduction

**NFS.** *Network File System*. Permet de rendre transparent l'accès et l'utilisation de fichiers distribués sur différentes machines. Développé par la société SUN (1984).

*Exemple.* Systèmes de fichiers distribués : Ceph, CIFS (Windows)

## Architecture générale : client/serveur

<https://www.ibm.com/developerworks/linux/library/l-network-filesystems/figure3.gif>

## Principe fonctionnel

Le serveur **exporte** un répertoire et l'arborescence associée de fichiers. Le client va **monter** cette arborescence distante dans celle qu'il possède localement. On parle de **montage NFS**.

Utilisation typique : gestion centralisée des répertoires des utilisateurs dans un LAN

Protocoles : NFS repose sur plusieurs protocoles et mécanismes associés.

## Les RPC

**RPC.** *Remote Procedure Call* : appel de procédure à distance ("fonction de C"). Dans une architecture client/serveur les RPC permettent au client de faire s'exécuter une fonction sur un serveur distant.

**XDR.** *eXternal Data Representation*. C'est un mécanisme et modèle de représentation de données (encodage/décodage). Permet l'échange de données entre architectures matérielles et systèmes différents (32/64 bits, CPU little/big endian, etc.).

## Caractéristiques de NFS

NFS (V2) est un protocole **sans état** (*stateless*). Un serveur ne conserve pas de donnée relative aux échanges en cours. Les requêtes RPC sont autonomes et **indempotentes** (requête non indempotente : ajout de donnée en fin de fichier). Il

- **Intérêt** d'un protocole sans état : reprise sur panne simplifiée, pas d'état à restaurer.
- **Inconvénients** : certaines opérations sur les fichiers nécessitant des états (exclus de NFS).

## Relation client/serveur indisponible

Pour chaque point de montage, trois alternatives :

1. *Hard mount* (par défaut) : le client reste bloqué en attente d'une réponse du serveur.
2. *Soft mount* : re-soumet un certain nombre de fois la requête puis sortie en erreur. L'application client doit traiter l'erreur.
3. *Interruptible mount* : comme 1 mais peut sortir de l'appel système (RPC en attente de réponse) si envoi d'un signal d'interruption.

## Contrôle d'accès aux fichiers

- Comparaison des UID / GID présenté dans la requête RPC
- Par défaut une requête "root" est déclassée en utilisateur "nobody" à faible privilèges.

Systèmes d'annuaires pour la destion d'accès aux attributs des utilisateurs : DAP, NIS (*Network Information System*)


.
