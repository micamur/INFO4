# Ingénierie Intéraction Homme Machine (IHM) - 2

## 0. Principes pour le développement de logiciels intéractifs

### Évènements

**Fonctions bloquantes** sur `getNextEvent` par exemple.

Évènement = **structure de données** :

-   **Type**
-   **_Timestamp_**
-   **Position** du curseur
-   **État** des boutons de la souris
-   **Identifiant** de la fenêtre
-   etc.

Types d'évènements (noms dépendent du système) : KeyPress, KeyRelease, etc.

Automate : $$E \\times S \\rightarrow S$$ (**\*E**vent\* et **\*S**tate\*)

**Boucle REPL** : _read-eval-print loop_

**_Dispatcher_** ou aiguilleur (Java AWT, Java SWING, etc.) au-dessus de la boucle REPL.

### Machines à états

**Démarche systématique** face à l'explosion combinatoire (type/ordre évènements)

**Automates** déterministes finis avec conditions et actions.

-   Lexique simplifié de la souris (mots) : _press_ ; _release_ ; _motion_
-   Syntaxe / machine à états (phrases) : press, release = clic ; press, motion, motion, release = drag

_Exemples._ Bouton

-   Bouton normal
-   Bouton normal avec possibilité de sortir avant de relâcher
-   Bouton inverseur ou play/pause

_Exemples._ Fenêtre

-   Zoom
-   Translate (ou drag and drop)
-   Translate avec distance minimale

```java
class Interaction implements EventHandler<MouseEvent> {
  enum State{IDLE, ZOOM_OR_DRAG, DRAGGIN};

  State state = State.IDLE;

  void handle(MouseEvent e) {
    switch(state) {
      case IDLE :
        switch(e.getEventType().getName()) {
          case "MOUSE_PRESSED":
            p = new Point2D(e.getX(), e.getY());
            state = State.ZOOM_OR_DRAG;
        }
        break;
      case ZOOM_OR_DRAG :
        switch(e.getEventType().getName()) {
          case "MOUSE_RELEASED":
            zoom(p, 5);
            state = State.IDLE;
            break;
          case "MOUSE_DRAGGING":
            if (p.distance (new Point2D(e.getX(), e.getY())) >= D_DRAG) {
              translate(e.getX(), e.getY());
              p = new Point2D(e.getX(), e.getY());
              state = State.DRAGGING;
            }
            break;
        }
    }
  }
}
```

.
